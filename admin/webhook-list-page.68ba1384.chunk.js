"use strict";(self.webpackChunkyuewu_dev=self.webpackChunkyuewu_dev||[]).push([[4121],{62872:(be,L,t)=>{t.r(L),t.d(L,{default:()=>ne});var e=t(53547),o=t(22551),w=t(87751),k=t(16550),R=t(22072),f=t(88767),F=t(14087),z=t(17034),H=t(185),O=t(53979),U=t(36989),i=t(75515),Z=t(29728),G=t(49066),Q=t(41580),Y=t(38939),K=t(49386),j=t(8060),P=t(79031),l=t(37909),x=t(92155),J=t(63237),X=t(15234),D=t(11047),q=t(3566),A=t(12028),_=t(89722),v=t(96315),B=t(20022),ee=t(4585),te=t(86031);const ae=()=>{const[se,c]=(0,e.useState)(!1),[b,r]=(0,e.useState)([]),{formatMessage:n}=(0,R.Z)(),{formatAPIError:m}=(0,o.useAPIErrorHandler)(),g=(0,o.useNotification)();(0,o.useFocusWhenNavigate)();const{push:oe}=(0,k.k6)(),{pathname:W}=(0,k.TH)(),{isLoading:le,allowedActions:{canCreate:C,canUpdate:V,canDelete:I}}=(0,o.useRBAC)(w.Z.settings.webhooks),{get:ie,post:re,put:de}=(0,o.useFetchClient)(),{notifyStatus:$}=(0,F.G)(),ce="webhooks",{isLoading:ue,data:d,error:T,refetch:p}=(0,f.useQuery)(ce,async()=>{const{data:{data:a}}=await ie("/admin/webhooks");return a});(0,e.useEffect)(()=>{if(T){g({type:"warning",message:m(T)});return}d&&$(n({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[d,T,g,n,$,m]);const N=(0,f.useMutation)(async()=>{await re("/admin/webhooks/batch-delete",{ids:b})},{onError(a){g({type:"warning",message:m(a)}),c(!1)},onSuccess(){r([]),c(!1),p()}}),me=(0,f.useMutation)(async({isEnabled:a,id:s})=>{const{id:E,...M}=d.find(ve=>ve.id===s)??{},fe={...M,isEnabled:a};await de(`/admin/webhooks/${s}`,fe)},{onError(a){g({type:"warning",message:m(a)})},onSuccess(){p()}}),ge=()=>N.mutate(),he=a=>r(a?d.map(s=>s.id):[]),Ee=(a,s)=>r(a?E=>[...E,s]:E=>E.filter(M=>M!==s)),S=a=>oe(`${W}/${a}`),y=le||ue,h=d?.length??0,u=b.length;return e.createElement(z.A,null,e.createElement(o.SettingsPageTitle,{name:"Webhooks"}),e.createElement(H.o,{"aria-busy":y},e.createElement(O.T,{title:n({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:n({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:C&&!y&&e.createElement(o.LinkButton,{startIcon:e.createElement(v.Z,null),variant:"default",to:`${W}/create`,size:"S"},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}),u>0&&I&&e.createElement(U.Z,{startActions:e.createElement(e.Fragment,null,e.createElement(i.Z,{variant:"epsilon",textColor:"neutral600"},n({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:u})),e.createElement(Z.z,{onClick:()=>c(!0),startIcon:e.createElement(B.Z,null),size:"L",variant:"danger-light"},n({id:"global.delete",defaultMessage:"Delete"})))}),e.createElement(G.D,null,y?e.createElement(Q.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(o.LoadingIndicatorPage,null)):h>0?e.createElement(Y.i,{colCount:5,rowCount:h+1,footer:e.createElement(K.c,{onClick:()=>C?S("create"):{},icon:e.createElement(v.Z,null)},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))},e.createElement(j.h,null,e.createElement(P.Tr,null,e.createElement(l.Th,null,e.createElement(x.C,{"aria-label":n({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:u>0&&u<h,value:u===h,onValueChange:he})),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(l.Th,{width:"60%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.form.url",defaultMessage:"URL"}))),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"}))),e.createElement(l.Th,null,e.createElement(J.T,null,n({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"}))))),e.createElement(X.p,null,d.map(a=>e.createElement(P.Tr,{key:a.id,...(0,o.onRowClick)({fn:()=>S(a.id),condition:V})},e.createElement(l.Td,{...o.stopPropagation},e.createElement(x.C,{"aria-label":`${n({id:"global.select",defaultMessage:"Select"})} ${a.name}`,value:b?.includes(a.id),onValueChange:s=>Ee(s,a.id),name:"select"})),e.createElement(l.Td,null,e.createElement(i.Z,{fontWeight:"semiBold",textColor:"neutral800"},a.name)),e.createElement(l.Td,null,e.createElement(i.Z,{textColor:"neutral800"},a.url)),e.createElement(l.Td,null,e.createElement(D.k,null,e.createElement(q.r,{onLabel:n({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:n({id:"global.disabled",defaultMessage:"Disabled"}),label:`${a.name} ${n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:a.isEnabled,onChange:s=>{s.stopPropagation(),me.mutate({isEnabled:!a.isEnabled,id:a.id})},visibleLabels:!0}))),e.createElement(l.Td,null,e.createElement(D.k,{gap:1},V&&e.createElement(A.h,{label:n({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:e.createElement(ee.Z,null),noBorder:!0}),I&&e.createElement(A.h,{onClick:s=>{s.stopPropagation(),r([a.id]),c(!0)},label:n({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:e.createElement(B.Z,null),noBorder:!0}))))))):e.createElement(_.x,{icon:e.createElement(te.Z,{width:"160px"}),content:n({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:e.createElement(Z.z,{variant:"secondary",startIcon:e.createElement(v.Z,null),onClick:()=>C?S("create"):{}},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}))),e.createElement(o.ConfirmDialog,{isOpen:se,onToggleDialog:()=>c(a=>!a),onConfirm:ge,isConfirmButtonLoading:N.isLoading}))},ne=()=>e.createElement(o.CheckPagePermissions,{permissions:w.Z.settings.webhooks.main},e.createElement(ae,null))}}]);
